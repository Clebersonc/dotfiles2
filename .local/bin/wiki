#!/usr/bin/dash
#
# Wikipedia simple search script.

if [ "$*" = "" ]; then
 	printf "%s\n" "wiki: expected an argument or more to search.";
	exit 0;
fi

# Fix search to use on url.
search=$(echo "$@" | tr ' ' '+')

printf "%s\n" "============================================"
printf "\t%s\n\n" "Welcome to WikiPedia Search";


# Get url's of search matches.
results=$(
	lynx --dump "http://en.wikipedia.org/wiki/Special:Search?search=""$search""=Go&ns0=1" |
	grep https://en.wikipedia.org/wiki |
	cut -c7- |
	sed '1d;2d;3d;4d;5d' |
	head --lines=9 |
	cut -d'/' -f5
)

# Display search matches with line numbers.
echo "$results" | tr ' ' '\n' | tr '_' ' ' | nl

printf "%s\n" "============================================"
printf "\t%s\n\t%s" "Please select the link to open:" "> "; read -r answer;

# The answer must be a number.
while ! echo "$answer" | grep -E "^[1-9]$" 1>/dev/null; do
	printf "\t%s\n\t%s" "Please enter a number [1-9]:" "> "; read -r answer;
done

# Get url from selected wiki page.
match=$(echo "$results" | tr ' ' '\n' | sed "$answer""q;d")

web "https://en.wikipedia.org/wiki/$match"
