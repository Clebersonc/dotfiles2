#!/usr/bin/sh
#
# Simple read mode

img="false"

if [ "$1" = "-i" ]; then
	img="true";
	shift;
fi
dmn=$(echo "$@" | cut -d'/' -f3)
printf "\n%s %s\n" "Domain:" "$dmn"
path=$(echo "$@" | cut -d'/' -f4-)
printf "\n%s %s\n" "  Path:" "$path"

page="https://pdf.fivefilters.org/makepdf.php?v=2.5&url=""$@""&mode=single-story&output=html&template=A4&title=+&order=desc&date=true&images=""$img""&api_key=&sub=read+mode"
html=/tmp/webpage.html

printf "\n%s " "Downloading page wait..."
curl -L $page > $html 2>/dev/null && printf "%s\n" "DONE"

# Correct webpage title name.
sed -i -e "s|<title>.*</title>|<title>Read Mode</title>|g" $html

# Remove the unecessery.
sed -i -e '37d' -e '35d' -e '27d' -e '22d' $html

# Open html file with floating windown and text based browser.
st-light -c dropdown -e w3m $html
